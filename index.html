<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AFD 1.0 Datacatalogus</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide-react/0.263.1/lucide-react.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <style>
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;
        const { 
            Search, Filter, ChevronRight, Database, Code, FileText, Hash, Type, Calendar, 
            ToggleLeft, Package, Copy, Check, Sun, Moon, Grid, List, Info, Clock,
            Star, Link2, Home, ChevronDown, X, Settings, HelpCircle, BookOpen
        } = lucideReact;

        // Mock file system voor GitHub Pages
        window.fs = {
            readFile: async (filename, options = {}) => {
                try {
                    const response = await fetch(filename);
                    if (!response.ok) {
                        throw new Error(`Bestand niet gevonden: ${filename}`);
                    }
                    
                    if (options.encoding === 'utf8') {
                        return await response.text();
                    }
                    
                    const arrayBuffer = await response.arrayBuffer();
                    return new Uint8Array(arrayBuffer);
                } catch (error) {
                    console.error('Error reading file:', filename, error);
                    throw error;
                }
            }
        };

        function AFDSearchTool() {
            const [data, setData] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [debouncedSearchTerm, setDebouncedSearchTerm] = useState('');
            const [searchMode, setSearchMode] = useState('normal');
            const [typeFilter, setTypeFilter] = useState('all');
            const [entityFilter, setEntityFilter] = useState('all');
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [stats, setStats] = useState({ total: 0, entities: 0, attributes: 0 });
            const [viewMode, setViewMode] = useState('expanded');
            const [darkMode, setDarkMode] = useState(false);
            const [copiedItem, setCopiedItem] = useState(null);
            const [currentPage, setCurrentPage] = useState(1);
            const searchInputRef = useRef(null);
            
            const ITEMS_PER_PAGE = 25;

            // Datatype info
            const datatypeInfo = {
                'JN': { label: 'Ja/Nee', icon: ToggleLeft, color: 'text-blue-600' },
                'A0': { label: 'Alfanumeriek', icon: Type, color: 'text-green-600' },
                'A1': { label: 'Alfanumeriek', icon: Type, color: 'text-green-600' },
                'A2': { label: 'Alfanumeriek', icon: Type, color: 'text-green-600' },
                'D1': { label: 'Datum', icon: Calendar, color: 'text-purple-600' },
                'D3': { label: 'Datum', icon: Calendar, color: 'text-purple-600' },
                'B2': { label: 'Bedrag', icon: Hash, color: 'text-yellow-600' },
                'T1': { label: 'Tijd', icon: Calendar, color: 'text-indigo-600' },
                'P3': { label: 'Percentage', icon: Hash, color: 'text-orange-600' },
                'ME': { label: 'Memo', icon: FileText, color: 'text-gray-600' }
            };

            // Debounce search term
            useEffect(() => {
                const timer = setTimeout(() => {
                    setDebouncedSearchTerm(searchTerm);
                    setCurrentPage(1);
                }, 300);
                return () => clearTimeout(timer);
            }, [searchTerm]);

            // Reset page when filters change
            useEffect(() => {
                setCurrentPage(1);
            }, [typeFilter, entityFilter]);

            // Keyboard shortcuts
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.key === '/' && !e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        searchInputRef.current?.focus();
                    }
                    if (e.key === 'Escape' && document.activeElement === searchInputRef.current) {
                        setSearchTerm('');
                    }
                };
                document.addEventListener('keydown', handleKeyDown);
                return () => document.removeEventListener('keydown', handleKeyDown);
            }, []);

            // Load preferences
            useEffect(() => {
                try {
                    const savedDarkMode = localStorage.getItem('afd-darkmode') === 'true';
                    setDarkMode(savedDarkMode);
                } catch (e) {
                    console.warn('LocalStorage not available');
                }
            }, []);

            // Save preferences
            useEffect(() => {
                try {
                    localStorage.setItem('afd-darkmode', darkMode);
                    document.documentElement.classList.toggle('dark', darkMode);
                } catch (e) {
                    console.warn('LocalStorage not available');
                }
            }, [darkMode]);

            // Load data
            useEffect(() => {
                const loadData = async () => {
                    try {
                        const csvContent = await window.fs.readFile('data.csv', { encoding: 'utf8' });
                        
                        const parsed = Papa.parse(csvContent, {
                            header: true,
                            dynamicTyping: true,
                            skipEmptyLines: true,
                            delimitersToGuess: [',', '\t', '|', ';']
                        });

                        const cleanedData = parsed.data.map(row => {
                            const cleanRow = {};
                            Object.keys(row).forEach(key => {
                                cleanRow[key.trim()] = row[key];
                            });
                            return cleanRow;
                        });

                        setData(cleanedData);
                        
                        const entities = cleanedData.filter(row => row['Entiteit/Attribuut'] === 'E').length;
                        const attributes = cleanedData.filter(row => row['Entiteit/Attribuut'] === 'A').length;
                        setStats({
                            total: cleanedData.length,
                            entities,
                            attributes
                        });
                        
                        setLoading(false);
                    } catch (err) {
                        setError('Fout bij het laden van data: ' + err.message);
                        setLoading(false);
                    }
                };

                loadData();
            }, []);

            // Search filter
            const searchFilter = useCallback((row, term) => {
                if (!term) return true;

                const searchFields = [
                    row.Naam,
                    row.Omschrijving,
                    row.Entiteitcode,
                    row.Attribuutcode
                ].filter(Boolean).join(' ').toLowerCase();

                if (searchMode === 'regex') {
                    try {
                        const regex = new RegExp(term, 'i');
                        return regex.test(searchFields);
                    } catch {
                        return false;
                    }
                } else if (searchMode === 'wildcard') {
                    const regexPattern = term
                        .replace(/[.*+?^${}()|[\]\\]/g, '\\$&')
                        .replace(/\*/g, '.*')
                        .replace(/\?/g, '.');
                    const regex = new RegExp(regexPattern, 'i');
                    return regex.test(searchFields);
                } else {
                    return searchFields.includes(term.toLowerCase());
                }
            }, [searchMode]);

            // Filtered data
            const filteredData = useMemo(() => {
                let filtered = data;

                if (typeFilter !== 'all') {
                    filtered = filtered.filter(row => row['Entiteit/Attribuut'] === typeFilter);
                }

                if (debouncedSearchTerm) {
                    filtered = filtered.filter(row => searchFilter(row, debouncedSearchTerm));
                }

                if (entityFilter !== 'all') {
                    filtered = filtered.filter(row => row.Entiteitcode === entityFilter);
                }

                return filtered;
            }, [data, debouncedSearchTerm, typeFilter, entityFilter, searchFilter]);

            // Available entities
            const availableEntities = useMemo(() => {
                const entityMap = new Map();
                filteredData.forEach(row => {
                    if (row.Entiteitcode && !entityMap.has(row.Entiteitcode)) {
                        entityMap.set(row.Entiteitcode, row.Entiteitcode);
                    }
                });
                return Array.from(entityMap.keys()).sort();
            }, [filteredData]);

            // Paginated data
            const paginatedData = useMemo(() => {
                const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
                const endIndex = startIndex + ITEMS_PER_PAGE;
                return filteredData.slice(startIndex, endIndex);
            }, [filteredData, currentPage]);

            const totalPages = Math.ceil(filteredData.length / ITEMS_PER_PAGE);

            // Copy function
            const copyToClipboard = useCallback((text, id) => {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text);
                } else {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
                setCopiedItem(id);
                setTimeout(() => setCopiedItem(null), 2000);
            }, []);

            // Highlight text
            const highlightText = (text, term) => {
                if (!text || !term || searchMode === 'regex') return text;
                
                const parts = text.split(new RegExp(`(${term})`, 'gi'));
                return parts.map((part, i) => 
                    part.toLowerCase() === term.toLowerCase() 
                        ? React.createElement('mark', { key: i, className: "bg-yellow-200 dark:bg-yellow-800 px-0.5 rounded" }, part)
                        : part
                );
            };

            if (loading) {
                return React.createElement('div', { 
                    className: `flex items-center justify-center h-screen ${darkMode ? 'bg-gray-900' : 'bg-gray-50'}` 
                }, 
                    React.createElement('div', { className: "text-center" },
                        React.createElement('div', { className: "animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto" }),
                        React.createElement('p', { 
                            className: `mt-4 ${darkMode ? 'text-gray-300' : 'text-gray-600'}` 
                        }, "AFD datacatalogus laden...")
                    )
                );
            }

            if (error) {
                return React.createElement('div', { 
                    className: `flex items-center justify-center h-screen ${darkMode ? 'bg-gray-900' : 'bg-gray-50'}` 
                }, 
                    React.createElement('div', { className: "text-center max-w-lg mx-auto p-6" },
                        React.createElement('div', { className: "text-red-600 mb-4" },
                            React.createElement('div', { className: "text-6xl mb-4" }, "⚠️"),
                            React.createElement('h2', { className: "text-xl font-bold mb-2" }, "Fout bij laden"),
                            React.createElement('p', { className: "text-sm" }, error)
                        ),
                        React.createElement('div', { className: "text-sm text-gray-600 dark:text-gray-400 mt-6 space-y-2" },
                            React.createElement('p', null, "Controleer of de volgende bestanden aanwezig zijn:"),
                            React.createElement('ul', { className: "list-disc list-inside space-y-1" },
                                React.createElement('li', null, "data.csv - Je AFD data"),
                                React.createElement('li', null, "Codelist.afm.csv - Je codelijst (optioneel)")
                            ),
                            React.createElement('p', { className: "mt-4 font-semibold" }, "Bestanden moeten in de root van je repository staan!")
                        )
                    )
                );
            }

            const containerClass = darkMode ? 'dark bg-gray-900 text-gray-100' : 'bg-gray-50';
            const cardClass = darkMode ? 'bg-gray-800 text-gray-100' : 'bg-white';

            return React.createElement('div', { className: `min-h-screen ${containerClass}` },
                // Header
                React.createElement('div', { className: `${cardClass} shadow-sm border-b ${darkMode ? 'border-gray-700' : ''}` },
                    React.createElement('div', { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4" },
                        React.createElement('div', { className: "flex items-center justify-between" },
                            React.createElement('div', { className: "flex items-center space-x-3" },
                                React.createElement(Database, { className: "h-8 w-8 text-blue-600" }),
                                React.createElement('div', null,
                                    React.createElement('h1', { 
                                        className: `text-2xl font-bold ${darkMode ? 'text-gray-100' : 'text-gray-900'}` 
                                    }, "AFD 1.0 Datacatalogus"),
                                    React.createElement('div', { className: "flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400" },
                                        React.createElement('span', null, stats.total.toLocaleString() + ' items'),
                                        React.createElement('span', null, '•'),
                                        React.createElement('span', null, stats.entities + ' entiteiten'),
                                        React.createElement('span', null, '•'),
                                        React.createElement('span', null, stats.attributes.toLocaleString() + ' attributen')
                                    )
                                )
                            ),
                            React.createElement('button', {
                                onClick: () => setDarkMode(!darkMode),
                                className: "p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",
                                title: darkMode ? 'Light mode' : 'Dark mode'
                            }, darkMode ? React.createElement(Sun, { className: "h-5 w-5" }) : React.createElement(Moon, { className: "h-5 w-5" }))
                        )
                    )
                ),

                // Search section
                React.createElement('div', { className: `${cardClass} border-b ${darkMode ? 'border-gray-700' : ''} sticky top-0 z-10` },
                    React.createElement('div', { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4" },
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('div', { className: "flex gap-2" },
                                React.createElement('div', { className: "relative flex-1" },
                                    React.createElement(Search, { className: "absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400" }),
                                    React.createElement('input', {
                                        ref: searchInputRef,
                                        type: "text",
                                        value: searchTerm,
                                        onChange: (e) => setSearchTerm(e.target.value),
                                        placeholder: "Zoek op naam, omschrijving of code... (druk / voor focus)",
                                        className: `w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg ${
                                            darkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : ''
                                        }`
                                    }),
                                    searchTerm && React.createElement('button', {
                                        onClick: () => setSearchTerm(''),
                                        className: "absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                                    }, "✕")
                                ),
                                React.createElement('select', {
                                    value: searchMode,
                                    onChange: (e) => setSearchMode(e.target.value),
                                    className: `px-3 py-2 border rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`,
                                    title: "Zoek modus"
                                },
                                    React.createElement('option', { value: "normal" }, "Normaal"),
                                    React.createElement('option', { value: "wildcard" }, "Wildcard (* ?)"),
                                    React.createElement('option', { value: "regex" }, "Regex")
                                )
                            ),
                            React.createElement('div', { className: "flex flex-wrap gap-4" },
                                React.createElement('div', { className: "flex items-center space-x-2" },
                                    React.createElement(Filter, { className: "h-5 w-5 text-gray-400" }),
                                    React.createElement('select', {
                                        value: typeFilter,
                                        onChange: (e) => setTypeFilter(e.target.value),
                                        className: `border rounded-lg px-3 py-2 ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`
                                    },
                                        React.createElement('option', { value: "all" }, "Alle types"),
                                        React.createElement('option', { value: "E" }, "Alleen entiteiten"),
                                        React.createElement('option', { value: "A" }, "Alleen attributen")
                                    )
                                ),
                                availableEntities.length > 0 && React.createElement('div', { className: "flex items-center space-x-2" },
                                    React.createElement(Database, { className: "h-5 w-5 text-gray-400" }),
                                    React.createElement('select', {
                                        value: entityFilter,
                                        onChange: (e) => setEntityFilter(e.target.value),
                                        className: `border rounded-lg px-3 py-2 ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`
                                    },
                                        React.createElement('option', { value: "all" }, `Alle entiteiten (${availableEntities.length})`),
                                        availableEntities.map(entity => 
                                            React.createElement('option', { key: entity, value: entity }, entity)
                                        )
                                    )
                                )
                            )
                        )
                    )
                ),

                // Results
                React.createElement('div', { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6" },
                    !searchTerm && typeFilter === 'all' && entityFilter === 'all' ?
                        React.createElement('div', { className: "text-center py-12" },
                            React.createElement('div', { className: `${cardClass} rounded-lg shadow-sm p-12 max-w-2xl mx-auto` },
                                React.createElement(Search, { className: "h-16 w-16 text-gray-400 mx-auto mb-4" }),
                                React.createElement('h2', { className: "text-2xl font-semibold text-gray-700 dark:text-gray-300 mb-2" }, "Begin met zoeken"),
                                React.createElement('p', { className: "text-gray-500 dark:text-gray-400 mb-6" }, 
                                    "Gebruik de zoekbalk hierboven om te zoeken in de AFD 1.0 datacatalogus met " + stats.total.toLocaleString() + " items"
                                ),
                                React.createElement('div', { className: "space-y-2 text-sm text-gray-500 dark:text-gray-400" },
                                    React.createElement('p', null, "Je kunt zoeken op:"),
                                    React.createElement('ul', { className: "list-disc list-inside space-y-1" },
                                        React.createElement('li', null, "Naam van een entiteit of attribuut"),
                                        React.createElement('li', null, "Omschrijving"),
                                        React.createElement('li', null, "Entiteitcode (bijv. OB, XA, RI)"),
                                        React.createElement('li', null, "Attribuutcode")
                                    )
                                ),
                                React.createElement('div', { className: "mt-6 flex justify-center" },
                                    React.createElement('kbd', { className: "px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded text-sm" }, "Druk op / om te beginnen met typen")
                                )
                            )
                        ) :
                        filteredData.length === 0 ?
                            React.createElement('div', { className: "text-center py-12" },
                                React.createElement('p', { className: "text-gray-500 dark:text-gray-400 text-lg" }, "Geen resultaten gevonden"),
                                React.createElement('p', { className: "text-gray-400 dark:text-gray-500 mt-2" }, "Probeer een andere zoekterm of pas de filters aan")
                            ) :
                            React.createElement('div', null,
                                React.createElement('div', { className: "flex justify-between items-center mb-4" },
                                    React.createElement('p', { className: "text-gray-600 dark:text-gray-400" }, 
                                        filteredData.length + (filteredData.length === 1 ? " resultaat" : " resultaten")
                                    ),
                                    totalPages > 1 && React.createElement('p', { className: "text-sm text-gray-500" }, 
                                        `Pagina ${currentPage} van ${totalPages}`
                                    )
                                ),
                                React.createElement('div', { className: "space-y-3" },
                                    paginatedData.map((item, index) => {
                                        const isEntity = item['Entiteit/Attribuut'] === 'E';
                                        const itemId = isEntity ? item.Entiteitcode : `${item.Entiteitcode}_${item.Attribuutcode}`;
                                        
                                        return React.createElement('div', { 
                                            key: index, 
                                            className: `${cardClass} rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow` 
                                        },
                                            React.createElement('div', { className: "flex items-start justify-between" },
                                                React.createElement('div', { className: "flex items-start space-x-3 flex-1" },
                                                    isEntity ? 
                                                        React.createElement(Database, { className: "h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0" }) :
                                                        React.createElement(Package, { className: "h-5 w-5 text-green-600 mt-0.5 flex-shrink-0" }),
                                                    React.createElement('div', { className: "flex-1 min-w-0" },
                                                        React.createElement('div', { className: "flex items-center space-x-2 flex-wrap mb-1" },
                                                            React.createElement('span', { className: "text-sm font-mono text-gray-500 dark:text-gray-400" }, itemId),
                                                            item.Datatype && datatypeInfo[item.Datatype] && 
                                                                React.createElement('span', { className: `inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${datatypeInfo[item.Datatype].color} bg-gray-100 dark:bg-gray-700` }, 
                                                                    datatypeInfo[item.Datatype].label
                                                                )
                                                        ),
                                                        React.createElement('h3', { className: "font-semibold text-gray-900 dark:text-gray-100 mb-1" }, 
                                                            highlightText(item.Naam, searchTerm)
                                                        ),
                                                        item.Omschrijving && React.createElement('p', { className: "text-gray-600 dark:text-gray-300 text-sm" }, 
                                                            highlightText(item.Omschrijving, searchTerm)
                                                        )
                                                    )
                                                ),
                                                React.createElement('div', { className: "flex items-center space-x-1 ml-2" },
                                                    React.createElement('button', {
                                                        onClick: () => copyToClipboard(itemId, itemId),
                                                        className: "p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",
                                                        title: "Kopieer code"
                                                    },
                                                        copiedItem === itemId ? 
                                                            React.createElement(Check, { className: "h-4 w-4 text-green-500" }) : 
                                                            React.createElement(Copy, { className: "h-4 w-4 text-gray-400" })
                                                    )
                                                )
                                            )
                                        );
                                    })
                                ),
                                // Pagination
                                totalPages > 1 && React.createElement('div', { className: "flex items-center justify-center space-x-2 mt-6" },
                                    React.createElement('button', {
                                        onClick: () => setCurrentPage(prev => Math.max(1, prev - 1)),
                                        disabled: currentPage === 1,
                                        className: `px-3 py-1 rounded ${
                                            currentPage === 1
                                                ? 'bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-700'
                                                : 'bg-white text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700'
                                        } border dark:border-gray-600`
                                    }, "Vorige"),
                                    React.createElement('span', { className: "px-3 py-1" }, `${currentPage} / ${totalPages}`),
                                    React.createElement('button', {
                                        onClick: () => setCurrentPage(prev => Math.min(totalPages, prev + 1)),
                                        disabled: currentPage === totalPages,
                                        className: `px-3 py-1 rounded ${
                                            currentPage === totalPages
                                                ? 'bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-700'
                                                : 'bg-white text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700'
                                        } border dark:border-gray-600`
                                    }, "Volgende")
                                )
                            )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(AFDSearchTool));
    </script>
</body>
</html>
