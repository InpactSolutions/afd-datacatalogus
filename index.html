<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AFD 1.0 Datacatalogus</title>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel voor JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- XLSX voor Excel bestanden -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- PapaParse voor CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <!-- Inline CSS styling (geen externe dependencies) -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #374151;
        }

        .bg-gray-50 { background-color: #f9fafb; }
        .bg-white { background-color: #ffffff; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-gray-200 { background-color: #e5e7eb; }
        .bg-gray-700 { background-color: #374151; }
        .bg-gray-800 { background-color: #1f2937; }
        .bg-gray-900 { background-color: #111827; }
        .bg-blue-500 { background-color: #3b82f6; }
        .bg-blue-100 { background-color: #dbeafe; }
        .bg-blue-50 { background-color: #eff6ff; }
        .bg-green-100 { background-color: #dcfce7; }
        .bg-yellow-200 { background-color: #fef08a; }
        .bg-yellow-800 { background-color: #92400e; }
        .bg-red-600 { background-color: #dc2626; }

        .text-white { color: #ffffff; }
        .text-gray-100 { color: #f3f4f6; }
        .text-gray-300 { color: #d1d5db; }
        .text-gray-400 { color: #9ca3af; }
        .text-gray-500 { color: #6b7280; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-900 { color: #111827; }
        .text-blue-600 { color: #2563eb; }
        .text-blue-800 { color: #1e40af; }
        .text-green-600 { color: #16a34a; }
        .text-green-500 { color: #22c55e; }
        .text-purple-600 { color: #9333ea; }
        .text-yellow-600 { color: #ca8a04; }
        .text-indigo-600 { color: #4f46e5; }
        .text-orange-600 { color: #ea580c; }
        .text-red-600 { color: #dc2626; }

        .border { border: 1px solid #e5e7eb; }
        .border-gray-200 { border-color: #e5e7eb; }
        .border-gray-600 { border-color: #4b5563; }
        .border-gray-700 { border-color: #374151; }
        .border-b { border-bottom: 1px solid #e5e7eb; }

        .rounded { border-radius: 0.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-full { border-radius: 9999px; }

        .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
        .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }

        .p-1 { padding: 0.25rem; }
        .p-2 { padding: 0.5rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-12 { padding: 3rem; }
        .px-1 { padding-left: 0.25rem; padding-right: 0.25rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .py-12 { padding-top: 3rem; padding-bottom: 3rem; }
        .pl-10 { padding-left: 2.5rem; }
        .pr-4 { padding-right: 1rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .ml-2 { margin-left: 0.5rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }

        .w-full { width: 100%; }
        .h-4 { height: 1rem; }
        .h-5 { height: 1.25rem; }
        .h-8 { height: 2rem; }
        .h-12 { height: 3rem; }
        .h-16 { height: 4rem; }
        .h-screen { height: 100vh; }
        .min-h-screen { min-height: 100vh; }
        .max-w-2xl { max-width: 42rem; }
        .max-w-7xl { max-width: 80rem; }
        .max-w-lg { max-width: 32rem; }

        .flex { display: flex; }
        .inline-flex { display: inline-flex; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .flex-1 { flex: 1 1 0%; }
        .flex-shrink-0 { flex-shrink: 0; }
        .flex-wrap { flex-wrap: wrap; }

        .space-x-1 > * + * { margin-left: 0.25rem; }
        .space-x-2 > * + * { margin-left: 0.5rem; }
        .space-x-3 > * + * { margin-left: 0.75rem; }
        .space-x-4 > * + * { margin-left: 1rem; }
        .space-y-1 > * + * { margin-top: 0.25rem; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }

        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }

        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-6xl { font-size: 3.75rem; }

        .font-mono { font-family: ui-monospace, SFMono-Regular, Consolas, monospace; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }

        .text-center { text-align: center; }
        .text-left { text-align: left; }

        .list-disc { list-style-type: disc; }
        .list-inside { list-style-position: inside; }

        .underline { text-decoration: underline; }

        .cursor-not-allowed { cursor: not-allowed; }

        .transform { transform: translateZ(0); }
        .translate-y-1\/2 { transform: translateY(-50%); }

        .absolute { position: absolute; }
        .relative { position: relative; }
        .sticky { position: sticky; }
        .top-0 { top: 0; }
        .top-1\/2 { top: 50%; }
        .left-3 { left: 0.75rem; }
        .right-3 { right: 0.75rem; }

        .z-10 { z-index: 10; }

        .overflow-hidden { overflow: hidden; }
        .min-w-0 { min-width: 0; }

        .transition-shadow { transition: box-shadow 0.15s ease-in-out; }

        .hover\:bg-gray-50:hover { background-color: #f9fafb; }
        .hover\:bg-gray-100:hover { background-color: #f3f4f6; }
        .hover\:bg-gray-700:hover { background-color: #374151; }
        .hover\:text-gray-600:hover { color: #4b5563; }
        .hover\:text-blue-800:hover { color: #1e40af; }
        .hover\:shadow-md:hover { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }

        .focus\:ring-2:focus { 
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); 
        }
        .focus\:border-transparent:focus { border-color: transparent; }

        .disabled\:bg-gray-100:disabled { background-color: #f3f4f6; }
        .disabled\:text-gray-400:disabled { color: #9ca3af; }
        .fixed { position: fixed; }
        .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
        .z-50 { z-index: 50; }
        .bg-opacity-50 { background-color: rgba(0, 0, 0, 0.5); }
        .max-h-\[90vh\] { max-height: 90vh; }
        .overflow-y-auto { overflow-y: auto; }
        .flex-col { flex-direction: column; }
        .flex-shrink-0 { flex-shrink: 0; }
        .break-words { word-wrap: break-word; }

        .h-3 { height: 0.75rem; }
        .w-3 { width: 0.75rem; }

        .bg-green-100 { background-color: #dcfce7; }
        .bg-green-800 { background-color: #166534; }
        .bg-red-100 { background-color: #fee2e2; }
        .bg-red-800 { background-color: #991b1b; }
        .text-green-800 { color: #166534; }
        .text-red-800 { color: #991b1b; }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Dark mode styles */
        .dark .bg-gray-50 { background-color: #111827; }
        .dark .bg-white { background-color: #1f2937; }
        .dark .bg-gray-100 { background-color: #374151; }
        .dark .bg-gray-700 { background-color: #4b5563; }
        .dark .bg-gray-800 { background-color: #1f2937; }
        .dark .bg-gray-900 { background-color: #111827; }
        .dark .text-gray-100 { color: #f3f4f6; }
        .dark .text-gray-300 { color: #d1d5db; }
        .dark .text-gray-400 { color: #9ca3af; }
        .dark .text-gray-500 { color: #6b7280; }
        .dark .border-gray-600 { border-color: #4b5563; }
        .dark .border-gray-700 { border-color: #374151; }
        .dark .placeholder-gray-400::placeholder { color: #9ca3af; }
        .dark .hover\:bg-gray-700:hover { background-color: #374151; }
        .dark .bg-yellow-800 { background-color: #92400e; }

        /* Input styling */
        input, select {
            appearance: none;
            background-color: white;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            color: #111827;
        }

        .dark input, .dark select {
            background-color: #374151;
            border-color: #4b5563;
            color: #f3f4f6;
        }

        button {
            background: none;
            border: none;
            cursor: pointer;
            font-family: inherit;
        }

        button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Mark styling */
        mark {
            background-color: #fef08a;
            padding: 0.125rem;
            border-radius: 0.125rem;
        }

        .dark mark {
            background-color: #92400e;
            color: #fef3c7;
        }

        /* Code styling */
        code {
            font-family: ui-monospace, SFMono-Regular, Consolas, monospace;
            font-size: 0.875rem;
            background-color: #f3f4f6;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
        }

        .dark code {
            background-color: #374151;
        }

        /* Selection highlight for keyboard navigation */
        .selected-item {
            background-color: #dbeafe !important;
            border: 2px solid #3b82f6 !important;
            box-shadow: 0 0 0 1px #3b82f6;
        }

        .dark .selected-item {
            background-color: #1e3a8a !important;
            border: 2px solid #60a5fa !important;
            box-shadow: 0 0 0 1px #60a5fa;
        }

        .selected-item .text-gray-500 {
            color: #374151 !important;
        }

        .selected-item .text-gray-600 {
            color: #111827 !important;
        }

        .selected-item .text-gray-700 {
            color: #111827 !important;
        }

        .selected-item .text-gray-900 {
            color: #111827 !important;
        }

        .dark .selected-item .text-gray-100 {
            color: #f3f4f6 !important;
        }

        .dark .selected-item .text-gray-300 {
            color: #e5e7eb !important;
        }

        .dark .selected-item .text-gray-500 {
            color: #d1d5db !important;
        }

        /* Responsive */
        @media (min-width: 640px) {
            .sm\:px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        }

        @media (min-width: 1024px) {
            .lg\:px-8 { padding-left: 2rem; padding-right: 2rem; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        // SVG Icons als React componenten
        const Search = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        );

        const Database = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <ellipse cx="12" cy="5" rx="9" ry="3"/>
                <path d="m21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
            </svg>
        );

        const Package = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="m7.5 4.27 9 5.15"/>
                <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/>
                <path d="m3.3 7 8.7 5 8.7-5"/>
                <path d="M12 22V12"/>
            </svg>
        );

        const Filter = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"/>
            </svg>
        );

        const Copy = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
            </svg>
        );

        const Check = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="20,6 9,17 4,12"/>
            </svg>
        );

        const Sun = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="5"/>
                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
            </svg>
        );

        const Moon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
        );

        const BookOpen = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
        );

        const X = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
        );

        const ClipboardList = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
            </svg>
        );

        const Info = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
                <path d="m12 16v-4"/>
                <path d="m12 8h.01"/>
            </svg>
        );

        // Mock file system voor GitHub Pages
        window.fs = {
            readFile: async (filename, options = {}) => {
                try {
                    console.log(`Attempting to load: ${filename}`);
                    const response = await fetch(filename);
                    if (!response.ok) {
                        throw new Error(`Bestand niet gevonden: ${filename} (Status: ${response.status})`);
                    }
                    
                    if (options.encoding === 'utf8') {
                        const text = await response.text();
                        console.log(`Successfully loaded: ${filename} (${text.length} characters)`);
                        return text;
                    }
                    
                    const arrayBuffer = await response.arrayBuffer();
                    return new Uint8Array(arrayBuffer);
                } catch (error) {
                    console.error('Error reading file:', filename, error);
                    throw error;
                }
            }
        };

        function AFDSearchTool() {
            const [data, setData] = useState([]);
            const [codelistData, setCodelistData] = useState({});
            const [anvaData, setAnvaData] = useState({});
            const [searchTerm, setSearchTerm] = useState('');
            const [debouncedSearchTerm, setDebouncedSearchTerm] = useState('');
            const [typeFilter, setTypeFilter] = useState('all');
            const [entityFilter, setEntityFilter] = useState('all');
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [stats, setStats] = useState({ total: 0, entities: 0, attributes: 0 });
            const [darkMode, setDarkMode] = useState(false);
            const [copiedItem, setCopiedItem] = useState(null);
            const [currentPage, setCurrentPage] = useState(1);
            const [selectedCodelist, setSelectedCodelist] = useState(null);
            const [codelistSearch, setCodelistSearch] = useState('');
            const [selectedItemIndex, setSelectedItemIndex] = useState(-1);
            const [keyboardActive, setKeyboardActive] = useState(false);
            const [showInfo, setShowInfo] = useState(false);
            const searchInputRef = useRef(null);
            const itemRefs = useRef([]);
            
            const ITEMS_PER_PAGE = 25;

            // Datatype info
            const datatypeInfo = {
                'JN': { label: 'Ja/Nee', color: 'text-blue-600' },
                'A0': { label: 'Alfanumeriek', color: 'text-green-600' },
                'A1': { label: 'Alfanumeriek', color: 'text-green-600' },
                'A2': { label: 'Alfanumeriek', color: 'text-green-600' },
                'D1': { label: 'Datum', color: 'text-purple-600' },
                'D3': { label: 'Datum', color: 'text-purple-600' },
                'B2': { label: 'Bedrag', color: 'text-yellow-600' },
                'T1': { label: 'Tijd', color: 'text-indigo-600' },
                'P3': { label: 'Percentage', color: 'text-orange-600' },
                'ME': { label: 'Memo', color: 'text-gray-600' }
            };

            // Simple keyboard navigation
            useEffect(() => {
                const handleKeyDown = (e) => {
                    // Don't interfere with modals or inputs
                    if (selectedCodelist || showInfo || e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
                        return;
                    }

                    console.log('Key:', e.key, 'Results:', paginatedData.length, 'Selected:', selectedItemIndex, 'Search:', debouncedSearchTerm);

                    if (e.key === '/') {
                        e.preventDefault();
                        searchInputRef.current?.focus();
                        return;
                    }

                    if (e.key === 'Escape') {
                        console.log('Escape pressed - clearing search and selection');
                        setSelectedItemIndex(-1);
                        setKeyboardActive(false);
                        setSearchTerm('');
                        return;
                    }

                    if (paginatedData.length > 0) {
                        if (e.key === 'ArrowDown') {
                            e.preventDefault();
                            setKeyboardActive(true);
                            setSelectedItemIndex(prev => {
                                const newIndex = prev >= paginatedData.length - 1 ? 0 : prev + 1;
                                console.log('Arrow Down - new index:', newIndex);
                                return newIndex;
                            });
                        }

                        if (e.key === 'ArrowUp') {
                            e.preventDefault();
                            setKeyboardActive(true);
                            setSelectedItemIndex(prev => {
                                const newIndex = prev <= 0 ? paginatedData.length - 1 : prev - 1;
                                console.log('Arrow Up - new index:', newIndex);
                                return newIndex;
                            });
                        }

                        if (e.key === 'Enter' && selectedItemIndex >= 0) {
                            e.preventDefault();
                            const item = paginatedData[selectedItemIndex];
                            console.log('Enter pressed - copying item:', item);
                            if (item) {
                                const isEntity = item['Entiteit/Attribuut'] === 'E';
                                const itemId = isEntity ? item.Entiteitcode : `${item.Entiteitcode}_${item.Attribuutcode}`;
                                console.log('Copying:', itemId);
                                copyToClipboard(itemId, itemId);
                            }
                        }
                    } else {
                        console.log('No results to navigate through');
                    }
                };

                document.addEventListener('keydown', handleKeyDown);
                return () => document.removeEventListener('keydown', handleKeyDown);
            }, [paginatedData, selectedItemIndex, selectedCodelist, debouncedSearchTerm, showInfo]);

            // Scroll to selected item
            useEffect(() => {
                if (selectedItemIndex >= 0 && keyboardActive && itemRefs.current[selectedItemIndex]) {
                    itemRefs.current[selectedItemIndex].scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                }
            }, [selectedItemIndex, keyboardActive]);

            // Debounce search term
            useEffect(() => {
                const timer = setTimeout(() => {
                    setDebouncedSearchTerm(searchTerm);
                    setCurrentPage(1);
                    setSelectedItemIndex(-1);
                    setKeyboardActive(false);
                }, 300);
                return () => clearTimeout(timer);
            }, [searchTerm]);

            // Reset page when filters change
            useEffect(() => {
                setCurrentPage(1);
                setSelectedItemIndex(-1);
                setKeyboardActive(false);
            }, [typeFilter, entityFilter]);

            // Reset selected item when page changes
            useEffect(() => {
                setSelectedItemIndex(-1);
                setKeyboardActive(false);
                itemRefs.current = [];
            }, [currentPage]);

            // Load preferences
            useEffect(() => {
                try {
                    const savedDarkMode = localStorage.getItem('afd-darkmode') === 'true';
                    setDarkMode(savedDarkMode);
                } catch (e) {
                    console.warn('LocalStorage not available');
                }
            }, []);

            // Save preferences
            useEffect(() => {
                try {
                    localStorage.setItem('afd-darkmode', darkMode);
                    document.documentElement.classList.toggle('dark', darkMode);
                } catch (e) {
                    console.warn('LocalStorage not available');
                }
            }, [darkMode]);

            // Load data
            useEffect(() => {
                const loadData = async () => {
                    try {
                        console.log('🔄 Starting to load AFD data...');
                        const csvContent = await window.fs.readFile('data.csv', { encoding: 'utf8' });
                        console.log('✅ CSV loaded successfully, parsing...');
                        
                        const parsed = Papa.parse(csvContent, {
                            header: true,
                            dynamicTyping: true,
                            skipEmptyLines: true,
                            delimitersToGuess: [',', '\t', '|', ';']
                        });

                        console.log(`📊 Parsed ${parsed.data.length} rows`);

                        const cleanedData = parsed.data.map(row => {
                            const cleanRow = {};
                            Object.keys(row).forEach(key => {
                                cleanRow[key.trim()] = row[key];
                            });
                            return cleanRow;
                        });

                        // Load codelist data (optional)
                        try {
                            console.log('🔄 Attempting to load codelist data...');
                            const codelistContent = await window.fs.readFile('Codelist.afm.csv', { encoding: 'utf8' });
                            console.log('✅ Codelist loaded, parsing...');
                            
                            const parsedCodelist = Papa.parse(codelistContent, {
                                header: false,
                                dynamicTyping: true,
                                skipEmptyLines: true,
                                delimiter: ';'
                            });

                            const codelistGroups = {};
                            let codelistCount = 0;
                            parsedCodelist.data.slice(1).forEach(row => {
                                const [codelijst, code, omschrijving, actief] = row;
                                if (codelijst) {
                                    if (!codelistGroups[codelijst]) {
                                        codelistGroups[codelijst] = [];
                                    }
                                    codelistGroups[codelijst].push({
                                        code: String(code || ''),
                                        omschrijving: String(omschrijving || ''),
                                        actief: String(actief || '')
                                    });
                                    codelistCount++;
                                }
                            });

                            setCodelistData(codelistGroups);
                            console.log(`📚 Codelist loaded: ${Object.keys(codelistGroups).length} lists, ${codelistCount} total items`);
                        } catch (err) {
                            console.warn('⚠️ Codelist data not found or could not be loaded:', err.message);
                        }

                        // Load ANVA mapping data (optional)
                        try {
                            console.log('🔄 Attempting to load ANVA mapping data...');
                            const anvaResponse = await window.fs.readFile('ANVA AFD.xlsx');
                            console.log('✅ ANVA Excel loaded, parsing...');
                            
                            const anvaWorkbook = XLSX.read(anvaResponse, {
                                cellStyles: true,
                                cellFormulas: true,
                                cellDates: true
                            });
                            
                            const anvaSheet = anvaWorkbook.Sheets[anvaWorkbook.SheetNames[0]];
                            const anvaJsonData = XLSX.utils.sheet_to_json(anvaSheet);
                            
                            const anvaMapping = {};
                            anvaJsonData.forEach(row => {
                                if (row.AFD && row.ANVA) {
                                    anvaMapping[row.AFD] = {
                                        code: String(row.ANVA || ''),
                                        omschrijving: String(row['ANVA Omschrijving'] || ''),
                                        afwijkendNietToegestaan: String(row['Afwijkend niet toegestaan'] || '')
                                    };
                                }
                            });
                            
                            setAnvaData(anvaMapping);
                            console.log(`📋 ANVA mapping loaded: ${Object.keys(anvaMapping).length} mappings`);
                        } catch (err) {
                            console.warn('⚠️ ANVA mapping data not found or could not be loaded:', err.message);
                        }

                        setData(cleanedData);
                        
                        const entities = cleanedData.filter(row => row['Entiteit/Attribuut'] === 'E').length;
                        const attributes = cleanedData.filter(row => row['Entiteit/Attribuut'] === 'A').length;
                        setStats({
                            total: cleanedData.length,
                            entities,
                            attributes
                        });
                        
                        console.log(`🎉 Data loaded: ${cleanedData.length} total, ${entities} entities, ${attributes} attributes`);
                        setLoading(false);
                    } catch (err) {
                        console.error('❌ Error loading data:', err);
                        setError(err.message);
                        setLoading(false);
                    }
                };

                loadData();
            }, []);

            // Enhanced search filter with codelist support
            const searchFilter = useCallback((row, term) => {
                if (!term) return true;

                const basicFields = [
                    row.Naam,
                    row.Omschrijving,
                    row.Entiteitcode,
                    row.Attribuutcode,
                    row.Entiteitcode && row.Attribuutcode ? `${row.Entiteitcode}_${row.Attribuutcode}` : null,
                    row.Codelijst  // Now also search in codelist field
                ];

                // Add ANVA information if available
                const fullCode = row.Entiteitcode && row.Attribuutcode ? `${row.Entiteitcode}_${row.Attribuutcode}` : null;
                const anvaInfo = fullCode ? anvaData[fullCode] : null;
                if (anvaInfo) {
                    basicFields.push(anvaInfo.code);
                    basicFields.push(anvaInfo.omschrijving);  
                }

                const searchFields = basicFields.filter(Boolean).join(' ').toLowerCase();
                return searchFields.includes(term.toLowerCase());
            }, [anvaData]);

            // Filtered data
            const filteredData = useMemo(() => {
                let filtered = data;

                if (typeFilter !== 'all') {
                    filtered = filtered.filter(row => row['Entiteit/Attribuut'] === typeFilter);
                }

                if (debouncedSearchTerm) {
                    filtered = filtered.filter(row => searchFilter(row, debouncedSearchTerm));
                }

                if (entityFilter !== 'all') {
                    filtered = filtered.filter(row => row.Entiteitcode === entityFilter);
                }

                return filtered;
            }, [data, debouncedSearchTerm, typeFilter, entityFilter, searchFilter]);

            // Available entities with descriptions
            const availableEntities = useMemo(() => {
                const entityMap = new Map();
                filteredData.forEach(row => {
                    if (row.Entiteitcode && !entityMap.has(row.Entiteitcode)) {
                        const entityRecord = data.find(r => 
                            r.Entiteitcode === row.Entiteitcode && 
                            r['Entiteit/Attribuut'] === 'E'
                        );
                        entityMap.set(row.Entiteitcode, {
                            code: row.Entiteitcode,
                            naam: entityRecord ? entityRecord.Naam : row.Entiteitcode
                        });
                    }
                });
                return Array.from(entityMap.values()).sort((a, b) => a.code.localeCompare(b.code));
            }, [filteredData, data]);

            // Paginated data
            const paginatedData = useMemo(() => {
                const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;  
                const endIndex = startIndex + ITEMS_PER_PAGE;
                return filteredData.slice(startIndex, endIndex);
            }, [filteredData, currentPage]);

            // Filtered codelist items
            const codelistItems = useMemo(() => {
                if (!selectedCodelist || !codelistData[selectedCodelist.codelijst]) return [];
                
                let items = codelistData[selectedCodelist.codelijst];
                
                items = items.filter(item => {
                    const code = String(item.code || '').trim();
                    return code !== '' && code.toLowerCase() !== 'code';
                });
                
                if (!codelistSearch) return items;
                
                const searchLower = codelistSearch.toLowerCase();
                return items.filter(item => {
                    const code = String(item.code || '').toLowerCase();
                    const omschrijving = String(item.omschrijving || '').toLowerCase();
                    
                    return code.includes(searchLower) || omschrijving.includes(searchLower);
                });
            }, [selectedCodelist, codelistData, codelistSearch]);

            const totalPages = Math.ceil(filteredData.length / ITEMS_PER_PAGE);

            const openCodelist = useCallback((codelijst, naam) => {
                setSelectedCodelist({ codelijst, naam });
                setCodelistSearch('');
            }, []);

            const copyToClipboard = useCallback((text, id) => {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text);
                } else {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
                setCopiedItem(id);
                setTimeout(() => setCopiedItem(null), 2000);
            }, []);

            // Copy full attribute info
            const copyFullAttributeInfo = useCallback((item, id) => {
                let entiteit = item.Entiteitcode || '';
                
                // Specifieke regels voor entiteit prefix
                if (entiteit === 'WH') {
                    // WH krijgt altijd PP/OG/ prefix
                    entiteit = `PP/OG/${entiteit}`;
                } else if (!['XG', 'XM', 'PP', 'AL'].includes(entiteit)) {
                    // Alle andere entiteiten (behalve XG, XM, PP, AL) krijgen PP/ prefix
                    entiteit = `PP/${entiteit}`;
                }
                // XG, XM, PP, AL blijven ongewijzigd
                
                const volledigAttribuut = item.Entiteitcode && item.Attribuutcode ? `${item.Entiteitcode}_${item.Attribuutcode}` : item.Entiteitcode || '';
                const omschrijving = item.Naam || '';
                const codelijst = item.Codelijst || '';
                
                const fullInfo = `${entiteit}\t${volledigAttribuut}\t${omschrijving}\t${codelijst}`;
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(fullInfo);
                } else {
                    const textArea = document.createElement('textarea');
                    textArea.value = fullInfo;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
                setCopiedItem(id);
                setTimeout(() => setCopiedItem(null), 2000);
            }, []);

            const highlightText = (text, term) => {
                if (!text || !term) return text;
                
                const parts = text.split(new RegExp(`(${term})`, 'gi'));
                return parts.map((part, i) => 
                    part.toLowerCase() === term.toLowerCase() 
                        ? <mark key={i}>{part}</mark>
                        : part
                );
            };

            if (loading) {
                return (
                    <div className={`flex items-center justify-center h-screen ${darkMode ? 'bg-gray-900' : 'bg-gray-50'}`}>
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
                            <p className={`mt-4 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                                AFD datacatalogus laden...
                            </p>
                        </div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className={`flex items-center justify-center h-screen ${darkMode ? 'bg-gray-900' : 'bg-gray-50'}`}>
                        <div className="text-center max-w-lg mx-auto p-6">
                            <div className="text-red-600 mb-4">
                                <div className="text-6xl mb-4">⚠️</div>
                                <h2 className="text-xl font-bold mb-2">Fout bij laden</h2>
                                <p className="text-sm mb-4">{error}</p>
                            </div>
                            <div className="text-sm text-gray-600 space-y-2">
                                <p><strong>Controleer het volgende:</strong></p>
                                <ul className="list-disc list-inside space-y-1 text-left">
                                    <li>Het bestand <code>data.csv</code> staat in de root van je repository</li>
                                    <li>Het bestand heeft exact de naam <code>data.csv</code> (let op hoofdletters)</li>
                                    <li>Het CSV bestand is geldig en UTF-8 encoded</li>
                                    <li>GitHub Pages is correct ingesteld</li>
                                </ul>
                                <p className="mt-4">
                                    <strong>Test:</strong> <a 
                                        href="data.csv" 
                                        target="_blank" 
                                        className="text-blue-600 underline"
                                    >
                                        Probeer data.csv direct te openen
                                    </a>
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className={`min-h-screen ${darkMode ? 'dark bg-gray-900 text-gray-100' : 'bg-gray-50'}`}>
                    {/* Header */}
                    <div className={`${darkMode ? 'bg-gray-800 text-gray-100' : 'bg-white'} shadow-sm border-b ${darkMode ? 'border-gray-700' : ''}`}>
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-3">
                                    <Database className="h-8 w-8 text-blue-600" />
                                    <div>
                                        <h1 className={`text-2xl font-bold ${darkMode ? 'text-gray-100' : 'text-gray-900'}`}>
                                            AFD 1.0 Datacatalogus
                                        </h1>
                                        <div className="flex items-center space-x-4 text-sm text-gray-500">
                                            <span>{stats.total.toLocaleString()} items</span>
                                            <span>•</span>
                                            <span>{stats.entities} entiteiten</span>
                                            <span>•</span>
                                            <span>{stats.attributes.toLocaleString()} attributen</span>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex items-center space-x-2">
                                    <button
                                        onClick={() => setShowInfo(true)}
                                        className={`p-2 rounded-lg ${darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`}
                                        title="Help & Instructies"
                                    >
                                        <svg className="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <circle cx="12" cy="12" r="10"/>
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="m12 16v-4"/>
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="m12 8h.01"/>
                                        </svg>
                                    </button>
                                    <button
                                        onClick={() => setDarkMode(!darkMode)}
                                        className={`p-2 rounded-lg ${darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`}
                                        title={darkMode ? 'Light mode' : 'Dark mode'}
                                    >
                                        {darkMode ? <Sun className="h-5 w-5" /> : <Moon className="h-5 w-5" />}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Search section */}
                    <div className={`${darkMode ? 'bg-gray-800 text-gray-100' : 'bg-white'} border-b ${darkMode ? 'border-gray-700' : ''} sticky top-0 z-10`}>
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                            <div className="space-y-4">
                                <div className="relative">
                                    <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400" />
                                    <input
                                        ref={searchInputRef}
                                        type="text"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        placeholder="Zoek op naam, omschrijving, AFD code, ANVA code of codelijst... (druk / voor focus)"
                                        className={`w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 text-lg ${
                                            darkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : ''
                                        }`}
                                    />
                                    {searchTerm && (
                                        <button
                                            onClick={() => setSearchTerm('')}
                                            className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                                        >
                                            ✕
                                        </button>
                                    )}

                    {/* Info Modal */}
                    {showInfo && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className={`${darkMode ? 'bg-gray-800 text-gray-100' : 'bg-white'} rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col`}>
                                <div className="flex-shrink-0 p-6 border-b ${darkMode ? 'border-gray-700' : 'border-gray-200'}">
                                    <div className="flex items-start justify-between">
                                        <div className="flex items-center space-x-3">
                                            <svg className="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <circle cx="12" cy="12" r="10"/>
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="m12 16v-4"/>
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="m12 8h.01"/>
                                            </svg>
                                            <h2 className={`text-xl font-bold ${darkMode ? 'text-gray-100' : 'text-gray-900'}`}>
                                                Help & Instructies
                                            </h2>
                                        </div>
                                        <button
                                            onClick={() => setShowInfo(false)}
                                            className={`p-2 rounded-lg flex-shrink-0 ${darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`}
                                        >
                                            <X className="h-5 w-5" />
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="flex-1 overflow-y-auto p-6 space-y-6">
                                    <div>
                                        <h3 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-gray-100' : 'text-gray-900'}`}>
                                            🔍 Zoeken
                                        </h3>
                                        <div className="space-y-2 text-sm">
                                            <p>Je kunt zoeken op:</p>
                                            <ul className="list-disc list-inside space-y-1 ml-4">
                                                <li>Naam van een entiteit of attribuut</li>
                                                <li>Omschrijving</li>
                                                <li>Entiteitcode (bijv. OB, XA, RI)</li>
                                                <li>Attribuutcode of volledige codes (bijv. DA_VERZSOM)</li>
                                                <li>ANVA code (bijv. 13689)</li>
                                                <li>Codelijst naam (bijv. ADNABS, SECTCOD)</li>
                                            </ul>
                                        </div>
                                    </div>

                                    <div>
                                        <h3 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-gray-100' : 'text-gray-900'}`}>
                                            ⌨️ Sneltoetsen
                                        </h3>
                                        <div className="space-y-2 text-sm">
                                            <div className="flex items-center justify-between p-2 rounded bg-gray-50 dark:bg-gray-700">
                                                <span><kbd className="px-2 py-1 bg-gray-200 dark:bg-gray-600 rounded text-xs">/</kbd></span>
                                                <span>Focus op zoekbalk</span>
                                            </div>
                                            <div className="flex items-center justify-between p-2 rounded bg-gray-50 dark:bg-gray-700">
                                                <span><kbd className="px-2 py-1 bg-gray-200 dark:bg-gray-600 rounded text-xs">↑ ↓</kbd></span>
                                                <span>Navigeer door zoekresultaten</span>
                                            </div>
                                            <div className="flex items-center justify-between p-2 rounded bg-gray-50 dark:bg-gray-700">
                                                <span><kbd className="px-2 py-1 bg-gray-200 dark:bg-gray-600 rounded text-xs">Enter</kbd></span>
                                                <span>Kopieer geselecteerd item</span>
                                            </div>
                                            <div className="flex items-center justify-between p-2 rounded bg-gray-50 dark:bg-gray-700">
                                                <span><kbd className="px-2 py-1 bg-gray-200 dark:bg-gray-600 rounded text-xs">Esc</kbd></span>
                                                <span>Wis zoekterm en selectie</span>
                                            </div>
                                        </div>
                                        <p className="text-xs text-gray-500 mt-2">
                                            💡 <strong>Tip:</strong> Klik buiten de zoekbalk om keyboard navigatie te activeren
                                        </p>
                                    </div>

                                    <div>
                                        <h3 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-gray-100' : 'text-gray-900'}`}>
                                            📋 Kopiëren
                                        </h3>
                                        <div className="space-y-2 text-sm">
                                            <div className="flex items-start space-x-2">
                                                <Copy className="h-4 w-4 mt-0.5 text-gray-400" />
                                                <span>Kopieer alleen de code (bijv. OB_NAAM)</span>
                                            </div>
                                            <div className="flex items-start space-x-2">
                                                <ClipboardList className="h-4 w-4 mt-0.5 text-gray-400" />
                                                <span>Kopieer volledige attribuut info (Entiteit, Code, Omschrijving, Codelijst)</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <h3 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-gray-100' : 'text-gray-900'}`}>
                                            📚 Codelijsten
                                        </h3>
                                        <div className="space-y-2 text-sm">
                                            <p>Klik op een codelijst link (bijv. <BookOpen className="h-3 w-3 inline" /> ADNABS) om alle waarden te bekijken.</p>
                                            <p>In de codelijst kun je:</p>
                                            <ul className="list-disc list-inside space-y-1 ml-4">
                                                <li>Zoeken naar specifieke codes of omschrijvingen</li>
                                                <li>Codes kopiëren naar het klembord</li>
                                                <li>Status zien (Actief/Inactief)</li>
                                            </ul>
                                        </div>
                                    </div>

                                    <div>
                                        <h3 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-gray-100' : 'text-gray-900'}`}>
                                            🎯 Filters
                                        </h3>
                                        <div className="space-y-2 text-sm">
                                            <div className="flex items-start space-x-2">
                                                <Filter className="h-4 w-4 mt-0.5 text-gray-400" />
                                                <span><strong>Type filter:</strong> Filter op entiteiten of attributen</span>
                                            </div>
                                            <div className="flex items-start space-x-2">
                                                <Database className="h-4 w-4 mt-0.5 text-gray-400" />
                                                <span><strong>Entiteit filter:</strong> Toon alleen attributen van een specifieke entiteit</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <h3 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-gray-100' : 'text-gray-900'}`}>
                                            🏷️ Labels & Info
                                        </h3>
                                        <div className="space-y-2 text-sm">
                                            <div className="flex flex-wrap gap-2">
                                                <span className="inline-flex items-center px-2 py-1 rounded text-xs font-medium text-blue-600 bg-blue-100">
                                                    Ja/Nee
                                                </span>
                                                <span className="inline-flex items-center px-2 py-1 rounded text-xs font-medium text-green-600 bg-gray-100">
                                                    Alfanumeriek
                                                </span>
                                                <span className="inline-flex items-center px-2 py-1 rounded text-xs font-medium text-purple-600 bg-gray-100">
                                                    Datum
                                                </span>
                                                <span className="text-gray-600">← Datatypes</span>
                                            </div>
                                            <div className="flex flex-wrap gap-2 items-center">
                                                <span className="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-yellow-200 text-yellow-800">
                                                    🔑 Primaire sleutel
                                                </span>
                                                <span className="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                                    🔗 Vreemde sleutel
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="text-xs text-gray-500 border-t pt-4">
                                        <p><strong>AFD 1.0 Datacatalogus</strong> • {stats.total.toLocaleString()} items • {stats.entities} entiteiten • {stats.attributes.toLocaleString()} attributen</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                                </div>
                                <div className="flex flex-wrap gap-4">
                                    <div className="flex items-center space-x-2">
                                        <Filter className="h-5 w-5 text-gray-400" />
                                        <select
                                            value={typeFilter}
                                            onChange={(e) => setTypeFilter(e.target.value)}
                                            className={`border rounded-lg px-3 py-2 ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : ''}`}
                                        >
                                            <option value="all">Alle types</option>
                                            <option value="E">Alleen entiteiten</option>
                                            <option value="A">Alleen attributen</option>
                                        </select>
                                    </div>
                                    {availableEntities.length > 0 && (
                                        <div className="flex items-center space-x-2">
                                            <Database className="h-5 w-5 text-gray-400" />
                                            <select
                                                value={entityFilter}
                                                onChange={(e) => setEntityFilter(e.target.value)}
                                                className={`border rounded-lg px-3 py-2 ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : ''}`}
                                            >
                                                <option value="all">Alle entiteiten ({availableEntities.length})</option>
                                                {availableEntities.map(entity => (
                                                    <option key={entity.code} value={entity.code}>
                                                        {entity.code} - {entity.naam}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                    )}
                                </div>
                                {paginatedData.length > 0 && (
                                    <div className="text-xs text-gray-500 space-y-1">
                                        <div>
                                            <strong>Sneltoetsen:</strong> ↑↓ navigeren door resultaten • Enter kopiëren geselecteerd item • / zoeken • Esc wissen
                                        </div>
                                        {keyboardActive && selectedItemIndex >= 0 && (
                                            <div className="text-blue-600 font-medium">
                                                <strong>📍 Geselecteerd:</strong> Item {selectedItemIndex + 1} van {paginatedData.length} • Druk Enter om te kopiëren
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Results */}
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                        {!searchTerm && typeFilter === 'all' && entityFilter === 'all' ? (
                            <div className="text-center py-12">
                                <div className={`${darkMode ? 'bg-gray-800 text-gray-100' : 'bg-white'} rounded-lg shadow-sm p-12 max-w-2xl mx-auto`}>
                                    <Search className="h-16 w-16 text-gray-400 mx-auto mb-4" />
                                    <h2 className={`text-2xl font-semibold mb-2 ${darkMode ? 'text-gray-200' : 'text-gray-700'}`}>
                                        Begin met zoeken
                                    </h2>
                                    <p className={`${darkMode ? 'text-gray-300' : 'text-gray-500'} mb-6`}>
                                        Gebruik de zoekbalk hierboven om te zoeken in de AFD 1.0 datacatalogus met {stats.total.toLocaleString()} items
                                    </p>
                                    <div className={`space-y-2 text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                        <p>Je kunt zoeken op:</p>
                                        <ul className="list-disc list-inside space-y-1">
                                            <li>Naam van een entiteit of attribuut</li>
                                            <li>Omschrijving</li>
                                            <li>Entiteitcode (bijv. OB, XA, RI)</li>
                                            <li>Attribuutcode of volledige codes (bijv. DA_VERZSOM)</li>
                                            <li>ANVA code (bijv. 13689)</li>
                                            <li>Codelijst naam (bijv. ADNABS, SECTCOD)</li>
                                        </ul>
                                    </div>
                                    <div className="mt-6 flex justify-center">
                                        <kbd className={`px-3 py-1 rounded text-sm ${
                                            darkMode ? 'bg-gray-700 text-gray-200 border border-gray-600' : 'bg-gray-200 text-gray-800'
                                        }`}>
                                            Druk op / om te beginnen met typen
                                        </kbd>
                                    </div>
                                </div>
                            </div>
                        ) : filteredData.length === 0 ? (
                            <div className="text-center py-12">
                                <p className="text-gray-500 text-lg">Geen resultaten gevonden</p>
                                <p className="text-gray-400 mt-2">Probeer een andere zoekterm of pas de filters aan</p>
                            </div>
                        ) : (
                            <div>
                                <div className="flex justify-between items-center mb-4">
                                    <p className="text-gray-600">
                                        {filteredData.length} {filteredData.length === 1 ? "resultaat" : "resultaten"}
                                    </p>
                                    {totalPages > 1 && (
                                        <p className="text-sm text-gray-500">
                                            Pagina {currentPage} van {totalPages}
                                        </p>
                                    )}
                                </div>
                                <div className="space-y-3">
                                    {paginatedData.map((item, index) => {
                                        const isEntity = item['Entiteit/Attribuut'] === 'E';
                                        const itemId = isEntity ? item.Entiteitcode : `${item.Entiteitcode}_${item.Attribuutcode}`;
                                        const isSelected = keyboardActive && selectedItemIndex === index;
                                        
                                        return (
                                            <div 
                                                key={index}
                                                ref={el => itemRefs.current[index] = el}
                                                className={`${darkMode ? 'bg-gray-800 text-gray-100' : 'bg-white'} rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow ${
                                                    isSelected ? 'selected-item' : ''
                                                }`}
                                            >
                                                <div className="flex items-start justify-between">
                                                    <div className="flex items-start space-x-3 flex-1">
                                                        {isEntity ? (
                                                            <Database className="h-5 w-5 text-blue-600 mt-1 flex-shrink-0" />
                                                        ) : (
                                                            <Package className="h-5 w-5 text-green-600 mt-1 flex-shrink-0" />
                                                        )}
                                                        <div className="flex-1 min-w-0">
                                                            <div className="flex items-center space-x-2 flex-wrap mb-1">
                                                                <span className="text-sm font-mono text-gray-500">
                                                                    {itemId}
                                                                </span>
                                                                {item.Datatype && datatypeInfo[item.Datatype] && (
                                                                    <span className={`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${datatypeInfo[item.Datatype].color} bg-gray-100`}>
                                                                        {datatypeInfo[item.Datatype].label}
                                                                    </span>
                                                                )}
                                                                {item.Codelijst && codelistData[item.Codelijst] && (
                                                                    <button
                                                                        onClick={() => openCodelist(item.Codelijst, item.Naam)}
                                                                        className="inline-flex items-center space-x-1 text-xs text-blue-600 hover:text-blue-800 underline"
                                                                        title={`Bekijk codelijst ${item.Codelijst} (${codelistData[item.Codelijst].length} items)`}
                                                                    >
                                                                        <BookOpen className="h-3 w-3" />
                                                                        <span>{highlightText(item.Codelijst, searchTerm)}</span>
                                                                    </button>
                                                                )}
                                                            </div>
                                                            <h3 className={`font-semibold ${darkMode ? 'text-gray-100' : 'text-gray-900'} mb-1`}>
                                                                {highlightText(item.Naam, searchTerm)}
                                                            </h3>
                                                            {item.Omschrijving && (
                                                                <p className={`${darkMode ? 'text-gray-300' : 'text-gray-600'} text-sm mb-2`}>
                                                                    {highlightText(item.Omschrijving, searchTerm)}
                                                                </p>
                                                            )}
                                                            
                                                            {/* Extra attribuut informatie */}
                                                            {!isEntity && (
                                                                <div className="space-y-1 text-xs text-gray-500">
                                                                    {item.Formaat && (
                                                                        <div className="flex items-center space-x-2">
                                                                            <span className="font-medium">Formaat:</span>
                                                                            <code className={`px-1 py-0.5 rounded ${darkMode ? 'bg-gray-700' : 'bg-gray-100'}`}>
                                                                                {item.Formaat}
                                                                            </code>
                                                                        </div>
                                                                    )}
                                                                    {(() => {
                                                                        // ANVA code opzoeken
                                                                        const fullCode = `${item.Entiteitcode}_${item.Attribuutcode}`;
                                                                        const anvaInfo = anvaData[fullCode];
                                                                        if (anvaInfo && anvaInfo.code) {
                                                                            return (
                                                                                <div className="flex items-center space-x-2">
                                                                                    <span className="font-medium">ANVA:</span>
                                                                                    <code className={`px-1 py-0.5 rounded ${darkMode ? 'bg-gray-700' : 'bg-gray-100'}`}>
                                                                                        {highlightText(anvaInfo.code, searchTerm)}
                                                                                    </code>
                                                                                    {anvaInfo.afwijkendNietToegestaan === 'J' && (
                                                                                        <span className="inline-flex items-center px-1 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">
                                                                                            ⚠️
                                                                                        </span>
                                                                                    )}
                                                                                </div>
                                                                            );
                                                                        }
                                                                        return null;
                                                                    })()}
                                                                    {item.Lengte && (
                                                                        <div className="flex items-center space-x-2">
                                                                            <span className="font-medium">Lengte:</span>
                                                                            <span>{item.Lengte}</span>
                                                                        </div>
                                                                    )}
                                                                    {item.Decimalen && (
                                                                        <div className="flex items-center space-x-2">
                                                                            <span className="font-medium">Decimalen:</span>
                                                                            <span>{item.Decimalen}</span>
                                                                        </div>
                                                                    )}
                                                                    {item.Verplicht && (
                                                                        <div className="flex items-center space-x-2">
                                                                            <span className="font-medium">Verplicht:</span>
                                                                            <span className={item.Verplicht === 'J' ? 'text-red-600' : 'text-green-600'}>
                                                                                {item.Verplicht === 'J' ? 'Ja' : 'Nee'}
                                                                            </span>
                                                                        </div>
                                                                    )}
                                                                    {item.Primairesleutel && item.Primairesleutel === 'J' && (
                                                                        <div className="flex items-center space-x-2">
                                                                            <span className="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-yellow-200 text-yellow-800">
                                                                                🔑 Primaire sleutel
                                                                            </span>
                                                                        </div>
                                                                    )}
                                                                    {item.Vreemdessleutel && item.Vreemdessleutel === 'J' && (
                                                                        <div className="flex items-center space-x-2">
                                                                            <span className="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                                                                🔗 Vreemde sleutel
                                                                            </span>
                                                                        </div>
                                                                    )}
                                                                    {item.Defaultwaarde && (
                                                                        <div className="flex items-center space-x-2">
                                                                            <span className="font-medium">Default:</span>
                                                                            <code className={`px-1 py-0.5 rounded ${darkMode ? 'bg-gray-700' : 'bg-gray-100'}`}>
                                                                                {item.Defaultwaarde}
                                                                            </code>
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center space-x-1 ml-2">
                                                        <button
                                                            onClick={() => copyToClipboard(itemId, itemId)}
                                                            className="p-1 hover:bg-gray-100 rounded"
                                                            title="Kopieer code"
                                                        >
                                                            {copiedItem === itemId ? (
                                                                <Check className="h-4 w-4 text-green-500" />
                                                            ) : (
                                                                <Copy className="h-4 w-4 text-gray-400" />
                                                            )}
                                                        </button>
                                                        {!isEntity && (
                                                            <button
                                                                onClick={() => copyFullAttributeInfo(item, `full-${itemId}`)}
                                                                className="p-1 hover:bg-gray-100 rounded"
                                                                title="Kopieer volledige attribuut info (Entiteit, Code, Omschrijving, Codelijst)"
                                                            >
                                                                {copiedItem === `full-${itemId}` ? (
                                                                    <Check className="h-4 w-4 text-green-500" />
                                                                ) : (
                                                                    <ClipboardList className="h-4 w-4 text-gray-400" />
                                                                )}
                                                            </button>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                                {/* Pagination */}
                                {totalPages > 1 && (
                                    <div className="flex items-center justify-center space-x-2 mt-6">
                                        <button
                                            onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
                                            disabled={currentPage === 1}
                                            className={`px-3 py-1 rounded border ${
                                                currentPage === 1
                                                    ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                                                    : 'bg-white text-gray-700 hover:bg-gray-50'
                                            }`}
                                        >
                                            Vorige
                                        </button>
                                        <span className="px-3 py-1">
                                            {currentPage} / {totalPages}
                                        </span>
                                        <button
                                            onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
                                            disabled={currentPage === totalPages}
                                            className={`px-3 py-1 rounded border ${
                                                currentPage === totalPages
                                                    ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                                                    : 'bg-white text-gray-700 hover:bg-gray-50'
                                            }`}
                                        >
                                            Volgende
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Codelist Modal */}
                    {selectedCodelist && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className={`${darkMode ? 'bg-gray-800 text-gray-100' : 'bg-white'} rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col`}>
                                <div className="flex-shrink-0 p-6 border-b ${darkMode ? 'border-gray-700' : 'border-gray-200'}">
                                    <div className="flex items-start justify-between">
                                        <div className="flex-1 min-w-0">
                                            <h2 className={`text-xl font-bold ${darkMode ? 'text-gray-100' : 'text-gray-900'}`}>
                                                Codelijst: {selectedCodelist.codelijst}
                                            </h2>
                                            <p className="text-sm text-gray-500 mt-1 truncate">{selectedCodelist.naam}</p>
                                            <p className="text-sm text-gray-500">
                                                {codelistItems.length} van {codelistData[selectedCodelist.codelijst]?.length || 0} items
                                            </p>
                                        </div>
                                        <button
                                            onClick={() => {
                                                setSelectedCodelist(null);
                                                setCodelistSearch('');
                                            }}
                                            className={`ml-4 p-2 rounded-lg flex-shrink-0 ${darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`}
                                        >
                                            <X className="h-5 w-5" />
                                        </button>
                                    </div>
                                    <div className="mt-4">
                                        <div className="relative">
                                            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none" />
                                            <input
                                                type="text"
                                                value={codelistSearch}
                                                onChange={(e) => setCodelistSearch(e.target.value)}
                                                placeholder="Zoek in codelijst..."
                                                className={`w-full pl-10 pr-10 py-2 border rounded-lg ${
                                                    darkMode ? 'bg-gray-700 border-gray-600 text-gray-100 placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                                                } focus:ring-2 focus:ring-blue-500 focus:border-transparent`}
                                                autoFocus
                                            />
                                            {codelistSearch && (
                                                <button
                                                    onClick={() => setCodelistSearch('')}
                                                    className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                                                >
                                                    <X className="h-4 w-4" />
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="flex-1 overflow-y-auto min-h-0 p-4">
                                    {codelistItems.length === 0 ? (
                                        <div className="text-center py-8">
                                            <p className="text-gray-500">
                                                {codelistSearch ? 'Geen items gevonden voor deze zoekopdracht' : 'Geen items in deze codelijst'}
                                            </p>
                                        </div>
                                    ) : (
                                        <div className="space-y-2">
                                            {codelistItems.map((item, index) => (
                                                <div 
                                                    key={index}
                                                    className={`flex items-start justify-between p-3 rounded-lg hover:shadow-sm transition-shadow ${
                                                        darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-50 hover:bg-gray-100'
                                                    }`}
                                                >
                                                    <div className="flex-1 min-w-0 pr-3">
                                                        <div className="flex items-center space-x-2 mb-1">
                                                            <code className={`font-mono text-sm font-semibold px-2 py-1 rounded ${
                                                                darkMode ? 'bg-gray-800 text-blue-400' : 'bg-blue-50 text-blue-600'
                                                            }`}>
                                                                {highlightText(String(item.code), codelistSearch)}
                                                            </code>
                                                            {item.actief === 'J' && (
                                                                <span className="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800">
                                                                    Actief
                                                                </span>
                                                            )}
                                                            {item.actief === 'N' && (
                                                                <span className="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-red-100 text-red-800">
                                                                    Inactief
                                                                </span>
                                                            )}
                                                        </div>
                                                        <p className={`text-sm break-words ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                                            {highlightText(String(item.omschrijving), codelistSearch)}
                                                        </p>
                                                    </div>
                                                    <button
                                                        onClick={() => copyToClipboard(String(item.code), `cl-${index}`)}
                                                        className={`flex-shrink-0 p-2 rounded transition-colors ${
                                                            darkMode ? 'hover:bg-gray-800' : 'hover:bg-gray-200'
                                                        }`}
                                                        title="Kopieer code"
                                                    >
                                                        {copiedItem === `cl-${index}` ? 
                                                            <Check className="h-4 w-4 text-green-500" /> : 
                                                            <Copy className="h-4 w-4 text-gray-400" />
                                                        }
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AFDSearchTool />);
    </script>
</body>
</html>
